<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.1.xsd">
<header>
	<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
	<title lang="en">Anti-Spam ACP</title>
	<description lang="en">Prevents spam on your phpBB3 forum.</description>

	<author-notes lang="en">PHP versions less than 5.1.0 are not supported.

Support will only be given at my website - http://www.lithiumstudios.org.</author-notes>

	<author-group>
		<author>
			<username>EXreaction</username>
			<realname>Nathan Guse</realname>
			<homepage>http://www.lithiumstudios.org/</homepage>
			<email>exreaction@lithiumstudios.org</email>
		</author>
	</author-group>

	<mod-version>0.1.X</mod-version>

	<installation>
		<level>easy</level>
		<time>180</time>
		<target-version>3.0.2</target-version>
	</installation>
</header>

<action-group>
	<copy>
		<file from="root/*.*" to="*.*" />
	</copy>
	<open src="includes/ucp/ucp_register.php">
		<edit>
			<find><![CDATA[include($phpbb_root_path . 'includes/functions_profile_fields.' . $phpEx);]]></find>
			<action type="after-add"><![CDATA[		// START Anti-Spam ACP
		$asacp_hidden = antispam::ucp_register();
		if ($asacp_hidden === false)
		{
			$this->tpl_name = 'antispam/ucp_register';
			return;
		}
		// END Anti-Spam ACP]]></action>
		</edit>
		<edit>
			<find><![CDATA[$s_hidden_fields = ($confirm_id) ? array('confirm_id' => $confirm_id) : array();]]></find>
			<action type="after-add"><![CDATA[			// START Anti-Spam ACP
			$s_hidden_fields = array_merge($s_hidden_fields, $asacp_hidden);
			// END Anti-Spam ACP]]></action>
		</edit>
		<edit>
			<find><![CDATA[						if (strcasecmp($row['code'], $data['confirm_code']) === 0)
						{
							$sql = 'DELETE FROM ' . CONFIRM_TABLE . "
								WHERE confirm_id = '" . $db->sql_escape($confirm_id) . "'
									AND session_id = '" . $db->sql_escape($user->session_id) . "'
									AND confirm_type = " . CONFIRM_REG;
							$db->sql_query($sql);
						}
						else
						{]]></find>
			<action type="after-add"><![CDATA[							// START Anti-Spam ACP
							antispam::add_log('LOG_INCORRECT_CODE', array($row['code'], $data['confirm_code']));
							// END Anti-Spam ACP]]></action>
		</edit>
		<edit>
			<find><![CDATA[$s_hidden_fields = build_hidden_fields($s_hidden_fields);]]></find>
			<action type="before-add"><![CDATA[		// START Anti-Spam ACP
		$s_hidden_fields = array_merge($s_hidden_fields, $asacp_hidden);
		// END Anti-Spam ACP]]></action>
		</edit>
    </open>
	<open src="styles/prosilver/template/overall_footer.html">
		<edit>
			<find><![CDATA[<!-- IF U_ACP --><br /><strong><a href="{U_ACP}">{L_ACP}</a></strong><!-- ENDIF -->]]></find>
			<action type="before-add"><![CDATA[		<br />{L_ASACP_CREDITS}]]></action>
		</edit>
    </open>
	<open src="common.php">
		<edit>
			<find><![CDATA[?>]]></find>
			<action type="before-add"><![CDATA[// START Anti-Spam ACP
require($phpbb_root_path . 'includes/antispam/asacp.' . $phpEx);
// END Anti-Spam ACP]]></action>
		</edit>
    </open>
	<open src="posting.php">
		<edit>
			<find><![CDATA[// Store message, sync counters]]></find>
			<action type="before-add"><![CDATA[		// START Anti-Spam ACP
		$sc_title = (empty($post_data['topic_title'])) ? $post_data['post_subject'] : $post_data['topic_title'];
		if (antispam::spam_words(array($sc_title, $message_parser->message)))
		{
			switch ($config['asacp_spam_words_posting_action'])
			{
				case 1 :
					$submit = false;
					$error[] = $user->lang['SPAM_DENIED'];
				break;

				case 2 :
					$config['enable_queue_trigger'] = true;
					$config['queue_trigger_posts'] = $user->data['user_posts'] + 1;
				break;
			}
		}
		// END Anti-Spam ACP]]></action>
		</edit>
    </open>
	<diy-instructions lang="en">Add the ACP Module.</diy-instructions>
</action-group>
</mod>